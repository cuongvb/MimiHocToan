<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>H·ªçc To√°n C√πng B√©</title>
    <style>
      body {
        font-family: "Comic Sans MS", "Segoe UI", sans-serif;
        background: linear-gradient(to bottom, #e0f7fa, #fffde7);
        margin: 0;
        padding: 10px; /* Gi·∫£m padding tr√™n mobile */
        text-align: center;
        color: #333;
        overflow-x: hidden;
      }

      h1 {
        color: #ff4081;
        margin: 10px 0 5px; /* Gi·∫£m margin */
        font-size: 2rem; /* Linh ho·∫°t h∆°n */
      }

      #levelInfo {
        font-size: 1.1rem;
        color: #4caf50;
        margin: 5px 0 15px;
        font-weight: bold;
      }

      .container {
        max-width: 900px;
        margin: auto;
        padding: 15px;
        background: #ffdeeb;
        border-radius: 25px;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
      }

      .menu {
        display: flex;
        flex-wrap: wrap; /* Cho ph√©p n√∫t xu·ªëng d√≤ng n·∫øu kh√¥ng v·ª´a */
        justify-content: center; /* CƒÉn gi·ªØa */
        gap: 10px; /* Kho·∫£ng c√°ch gi·ªØa n√∫t */
        margin-bottom: 20px;
      }

      .menu button {
        background: #81d4fa;
        border: none;
        padding: 12px 24px;
        font-size: 1.1rem; /* Linh ho·∫°t */
        cursor: pointer;
        border-radius: 15px;
        color: white;
        flex: 1 1 120px; /* N√∫t co gi√£n, min-width ~120px */
        max-width: 180px; /* Gi·ªõi h·∫°n max ƒë·ªÉ kh√¥ng to qu√° */
        box-sizing: border-box;
      }

      .menu button:hover {
        background: #4fc3f7;
      }

      #question {
        font-size: 1.6rem;
        margin: 20px 0;
        font-weight: bold;
      }

      #images {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 12px;
        min-height: 100px;
      }

      #images img {
        width: 80px;
        height: auto;
        object-fit: contain;
      }

      .answers {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 8px;
      }

      .answers button {
        background: #ffd54f;
        border: none;
        padding: 15px;
        margin: 5px;
        font-size: 1.5rem;
        cursor: pointer;
        border-radius: 50%;
        width: 70px;
        height: 70px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }

      .answers button:hover {
        background: #ffca28;
        transform: scale(1.1);
      }

      #feedback {
        font-size: 1.8rem;
        margin: 20px 0;
        font-weight: bold;
      }

      /* Responsive cho mobile (∆∞u ti√™n m√†n h√¨nh nh·ªè) */
      @media (max-width: 600px) {
        body {
          padding: 8px;
          font-size: 16px;
        } /* Base font nh·ªè h∆°n */

        h1 {
          font-size: 1.6rem;
          margin: 8px 0;
        } /* Ti√™u ƒë·ªÅ nh·ªè l·∫°i */

        #levelInfo {
          font-size: 1rem;
          margin: 5px 0;
        }

        .menu {
          flex-direction: column; /* N√∫t x·∫øp d·ªçc tr√™n mobile */
          gap: 12px;
        }

        .menu button {
          flex: 1 1 auto; /* Full width */
          max-width: none;
          padding: 14px;
          font-size: 1.2rem;
        }

        #question {
          font-size: 1.4rem;
          margin: 15px 0;
        }

        #images img {
          width: 60px;
        } /* H√¨nh nh·ªè h∆°n */

        .answers button {
          width: 60px;
          height: 60px;
          font-size: 1.3rem;
          padding: 10px;
          margin: 4px;
        }

        #feedback {
          font-size: 1.5rem;
        }
      }

      /* Tablet v·ª´a (n·∫øu c·∫ßn) */
      @media (min-width: 601px) and (max-width: 900px) {
        .menu button {
          flex: 1 1 140px;
          font-size: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üéÇüê•‚≠êH·ªçc To√°n C√πng Mi l√πn ‚≠êüê•üéÇ</h1>
      <div id="levelInfo">Level: D·ªÖ (0-9) ‚Ä¢ Chu·ªói ƒë√∫ng: 0</div>
      <div class="menu">
        <button onclick="startGame('count')">ƒê·∫øm S·ªë</button>
        <button onclick="startGame('add')">C·ªông</button>
        <button onclick="startGame('subtract')">Tr·ª´</button>
      </div>
      <div id="question"></div>
      <div id="images"></div>
      <div class="answers" id="answers"></div>
      <div id="feedback"></div>
    </div>

    <!-- √Çm thanh -->
    <audio id="bgMusic" loop>
      <source src="background.mp3" type="audio/mpeg" />
    </audio>
    <audio id="correctSound">
      <source src="correct.mp3" type="audio/mpeg" />
    </audio>
    <audio id="wrongSound">
      <source src="wrong.mp3" type="audio/mpeg" />
    </audio>

    <script>
      let mode = "";
      let correctAnswer = 0;
      let streak = 0; // Chu·ªói ƒë√∫ng li√™n ti·∫øp
      let level = "easy"; // 'easy' (0-9) ho·∫∑c 'hard' (0-20)
      const MAX_STREAK_TO_LEVEL_UP = 5;
      const images = [
        "cake1.png",
        "chick.png",
        "star.png",
        "cake2.png",
        "mushroom.png",
      ];

      // Ph√°t nh·∫°c n·ªÅn khi load (volume th·∫•p)
      window.onload = () => {
        const bg = document.getElementById("bgMusic");
        bg.volume = 0.3;
        bg.play().catch(() => console.log("Nh·∫•n m√†n h√¨nh ƒë·ªÉ b·∫≠t nh·∫°c nh√©!"));
        updateLevelInfo();
      };

      function updateLevelInfo() {
        const levelText = level === "easy" ? "D·ªÖ (0-9)" : "Kh√≥ (0-20)";
        document.getElementById(
          "levelInfo"
        ).innerHTML = `Level: ${levelText} ‚Ä¢ ƒê√£ ƒë√∫ng li√™n ti·∫øp: ${streak} c√¢u`;
      }

      function getRandomImage() {
        return images[Math.floor(Math.random() * images.length)];
      }

      function getMaxNumber() {
        return level === "easy" ? 9 : 20;
      }

      function startGame(selectedMode) {
        mode = selectedMode;
        streak = 0;
        level = "easy";
        document.getElementById("feedback").innerHTML = "";
        updateLevelInfo();
        generateQuestion();
      }

      function generateQuestion() {
        const imagesDiv = document.getElementById("images");
        const questionDiv = document.getElementById("question");
        const answersDiv = document.getElementById("answers");
        imagesDiv.innerHTML = "";
        answersDiv.innerHTML = "";

        const maxNum = getMaxNumber();
        let num1 = Math.floor(Math.random() * (maxNum + 1));
        let num2 = Math.floor(Math.random() * (maxNum + 1));

        if (mode === "count") {
          correctAnswer = num1;
          questionDiv.innerHTML = "C√≥ bao nhi√™u h√¨nh th·∫ø n√†y?";
          const imgSrc = getRandomImage();
          for (let i = 0; i < correctAnswer; i++) {
            const img = document.createElement("img");
            img.src = imgSrc;
            imagesDiv.appendChild(img);
          }
        } else if (mode === "add") {
          // Gi·ªØ t·ªïng ‚â§ maxNum*2 ƒë·ªÉ h·ª£p l√Ω
          num1 = Math.floor(Math.random() * (maxNum + 1));
          num2 = Math.floor(Math.random() * (maxNum + 1 - num1));
          correctAnswer = num1 + num2;
          questionDiv.innerHTML = `${num1} + ${num2} = ?`;
          const imgSrc1 = getRandomImage();
          const imgSrc2 = getRandomImage();
          for (let i = 0; i < num1; i++) {
            const img = document.createElement("img");
            img.src = imgSrc1;
            imagesDiv.appendChild(img);
          }
          imagesDiv.innerHTML +=
            ' <span style="font-size:40px; font-weight:bold;">+</span> ';
          for (let i = 0; i < num2; i++) {
            const img = document.createElement("img");
            img.src = imgSrc2;
            imagesDiv.appendChild(img);
          }
        } else if (mode === "subtract") {
          // ƒê·∫£m b·∫£o num1 >= num2
          num1 = Math.floor(Math.random() * (maxNum + 1));
          num2 = Math.floor(Math.random() * (num1 + 1));
          correctAnswer = num1 - num2;
          questionDiv.innerHTML = `${num1} - ${num2} = ?`;
          const imgSrc = getRandomImage();
          for (let i = 0; i < num1; i++) {
            const img = document.createElement("img");
            img.src = imgSrc;
            imagesDiv.appendChild(img);
          }
          imagesDiv.innerHTML +=
            ' <span style="font-size:40px; font-weight:bold;">-</span> ';
          for (let i = 0; i < num2; i++) {
            const img = document.createElement("img");
            img.src = imgSrc;
            img.style.opacity = 0.4;
            imagesDiv.appendChild(img);
          }
        }

        // T·∫°o n√∫t ƒë√°p √°n t·ª´ 0 ƒë·∫øn max*2 (ƒë·ªÉ an to√†n)
        const maxAnswer = maxNum * 2;
        for (let i = 0; i <= maxAnswer; i++) {
          const btn = document.createElement("button");
          btn.innerHTML = i;
          btn.onclick = () => checkAnswer(i);
          answersDiv.appendChild(btn);
        }
      }

      function checkAnswer(answer) {
        const feedback = document.getElementById("feedback");
        const correctAudio = document.getElementById("correctSound");
        const wrongAudio = document.getElementById("wrongSound");

        if (answer === correctAnswer) {
          streak++;
          feedback.innerHTML = "Gi·ªèi qu√°! üéâ‚ù§Ô∏è";
          feedback.style.color = "green";
          correctAudio.currentTime = 0;
          correctAudio.play().catch(() => {});

          if (streak >= MAX_STREAK_TO_LEVEL_UP && level === "easy") {
            level = "hard";
            feedback.innerHTML += " <br>üéà L√™n level kh√≥ h∆°n r·ªìi n√®! (0-20)";
            updateLevelInfo();
          } else {
            feedback.innerHTML += " üåü‚ú®";
          }
          updateLevelInfo();
        } else {
          streak = 0;
          feedback.innerHTML = "Th·ª≠ l·∫°i nh√© b√© ∆°i! üòä";
          feedback.style.color = "red";
          wrongAudio.currentTime = 0;
          wrongAudio.play().catch(() => {});
          level = "easy"; // Reset v·ªÅ d·ªÖ khi sai
          updateLevelInfo();
        }

        setTimeout(generateQuestion, 1500);
      }
    </script>
  </body>
</html>
